# 工作内容介绍
last update 2017/5/22

本文介绍到目前为止客户端方面的代码的主要工作。

## 一、进展

目前已经完成了控制连接，数据连接的代码并经过了初步的测试。

郑值同学完成了文件扫描部分的代码，目前也经过了初步的测试。文件扫描工作将根据设定文件扫描
若干个文件夹并上传其中的全部内容。每个文件夹中的文件的path是由设定文件设置的。

基于Erasure Code的分块代码是根据backblaze提供的开源包改写的，目前可以使用Encoder类的静态
函数encode进行分片；使用Decoder类的静态函数decode进行合并。每个分片的大小暂定为500kb，冗余
分块的数量暂定与数据分块的数量一致。即对于大小为X kb的文件，分块的数量将为2*(X//500+1)。

目前客户端已经可以将设定的文件夹中的文件自动分片并上传到服务器；也可以根据服务器的要求上传
或下载本地的分片。

与服务器的长期连接的可靠性仍需测试。

## 二、代码结构

### client包中是客户端的主体部分,目前包括

Client.java 客户端的主类,读取配置文件,启动客户端服务

SynItem.java 同步类,用于管理客户端各线程间的同步,使主线程可以检测各线程的工作状态.

### com.backblaze.erasure包是Erasure Code的开源实现,用于文件的分块

Decoder.java 文件合并类，包括静态函数decode进行文件合并

Encoder.java 文件分片类，包括静态函数encode进行文件分片

### connect包是客户端的链接部分,其中

ServerConnector.java 控制连接类,继承了Thread接口,可在新线程中执行.

FragmentManager.java 数据连接的碎片管理部分,继承了Thread接口,但目前不支持在新线程中执
行(需使用submit方法在调用者的线程中执行).

FileTransporter.java 是滕思洁编写的文件传输类.

### fileDetector包是客户端的文件扫描部分，其中

FileUploader.java  数据连接的文件上传部分

FileAttrs.java FolderScanner.java FileUtil.java 均由郑值同学负责，这里不作介绍。

## 三、客户的配置

客户端的目前使用其同一文件夹下的setup.ini文件进行配置

setup.ini文件的结构为

{服务器IP}
{服务器控制链接端口}
{服务器数据链接端口}
{客户端ID}
{碎片文件夹路径（用于保存服务器分配来的碎片）}
{临时文件夹路径（用于在上传过程中保存本地文件的碎片，上传完成后将被清空）}
{需要监控的上传文件夹数量}
{上传文件夹1路径}
{上传文件夹1中的文件在分布式文件系统中的path}
{上传文件夹2路径}
{上传文件夹2中的文件在分布式文件系统中的path}
。。。
